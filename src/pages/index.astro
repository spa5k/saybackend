---
import Button from "@components/Button.astro";
import Card from "@components/Card.astro";
import Container from "@components/Container.astro";
import Section from "@components/Section.astro";
import { HOME, SITE } from "@consts";
import Layout from "@layouts/Layout.astro";
import { getCollection } from "astro:content";

let blog = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_POSTS_ON_HOMEPAGE);

const projects = (await getCollection("projects"))
  .filter((project) => !project.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_PROJECTS_ON_HOMEPAGE);
---

<Layout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <!-- Structured Data -->
  <script
    type="application/ld+json"
    set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "WebSite",
          "@id": "https://www.saybackend.com/#website",
          url: "https://www.saybackend.com/",
          name: "SayBackend",
          description:
            "A engineering blog dedicated to backend systems, DevOps, and structural data patterns",
          publisher: {
            "@id": "https://www.saybackend.com/#organization",
          },
          potentialAction: {
            "@type": "SearchAction",
            target: {
              "@type": "EntryPoint",
              urlTemplate:
                "https://www.saybackend.com/pagefind/?q={search_term_string}",
            },
            "query-input": "required name=search_term_string",
          },
        },
        {
          "@type": "Organization",
          "@id": "https://www.saybackend.com/#organization",
          name: "SayBackend",
          url: "https://www.saybackend.com/",
          logo: {
            "@type": "ImageObject",
            url: "https://www.saybackend.com/favicon.ico",
          },
          sameAs: ["https://github.com/spa5k"],
          contactPoint: {
            "@type": "ContactPoint",
            email: "hello@kamran.sh",
            contactType: "customer service",
          },
        },
        {
          "@type": "BreadcrumbList",
          itemListElement: [
            {
              "@type": "ListItem",
              position: 1,
              name: "Home",
              item: "https://www.saybackend.com/",
            },
          ],
        },
      ],
    })}
  />
  <!-- Hero Section -->
  <Section class="py-20 md:py-32">
    <Container>
      <div class="max-w-4xl">
        <h1
          class="animate-fade-in-up text-foreground mb-8 text-[clamp(3.5rem,8vw,9rem)] leading-[0.85] font-black tracking-tighter uppercase"
        >
          Say<br />Backend
        </h1>
        <div
          class="animate-fade-in-up border-border border-t pt-8"
          style="animation-delay: 100ms;"
        >
          <p
            class="text-muted-foreground max-w-xl font-mono text-sm leading-relaxed md:text-base"
          >
            A blog dedicated to backend systems, DevOps, and structural data
            patterns. Exploring the intersection of brutalist architecture and
            clean code.
          </p>
        </div>
      </div>
    </Container>
  </Section>

  <!-- Marquee Banner -->
  <div
    class="border-structural bg-foreground text-background overflow-hidden border-b py-3 whitespace-nowrap"
  >
    <div
      class="animate-marquee inline-block font-mono text-xs font-bold tracking-widest uppercase"
    >
      BACKEND ENGINEERING /// DEVOPS PATTERNS /// SYSTEM ARCHITECTURE ///
      DATABASE DESIGN /// BACKEND ENGINEERING /// DEVOPS PATTERNS /// SYSTEM
      ARCHITECTURE /// DATABASE DESIGN /// BACKEND ENGINEERING /// DEVOPS
      PATTERNS /// SYSTEM ARCHITECTURE /// DATABASE DESIGN ///
    </div>
  </div>

  <!-- Latest Posts -->
  <Section class="py-16 md:py-24">
    <Container>
      <div class="mb-12 flex items-end justify-between">
        <h2 class="text-4xl font-black tracking-tight uppercase md:text-6xl">
          Latest Logs
        </h2>
        <Button href="/blog" variant="secondary" class="hidden md:flex"
          >View Archive</Button
        >
      </div>

      <div
        class="border-structural bg-border grid gap-px border md:grid-cols-2"
      >
        {
          blog.map((post, i) => {
            const cleanId = post.id.replace(/\/index$/, "");
            const primaryTag = post.data.tags?.[0];
            return (
              <Card
                href={`/blog/${cleanId}`}
                title={post.data.title}
                description={post.data.description}
                date={post.data.date}
                tag={primaryTag}
                class="h-full"
              />
            );
          })
        }
      </div>

      <div class="mt-8 md:hidden">
        <Button href="/blog" variant="secondary" class="w-full"
          >View Archive</Button
        >
      </div>
    </Container>
  </Section>

  <!-- Projects -->
  <Section class="bg-surface/60 py-16 md:py-24">
    <Container>
      <div class="mb-12 flex items-end justify-between">
        <h2 class="text-4xl font-black tracking-tight uppercase md:text-6xl">
          Works
        </h2>
        <Button href="/projects" variant="secondary" class="hidden md:flex"
          >All Projects</Button
        >
      </div>

      <div class="grid gap-8 md:grid-cols-2">
        {
          projects.map((project, i) => (
            <Card
              href={`/projects/${project.id}`}
              title={project.data.title}
              description={project.data.description}
              label={`SYS 2.${i} â€” PROJECT`}
            />
          ))
        }
      </div>

      <div class="mt-8 md:hidden">
        <Button href="/projects" variant="secondary" class="w-full"
          >All Projects</Button
        >
      </div>
    </Container>
  </Section>

  <!-- Connect -->
  <Section class="py-24 text-center">
    <Container>
      <h2
        class="mb-8 text-[clamp(3rem,6vw,6rem)] leading-none font-black tracking-tighter uppercase"
      >
        Collaborate
      </h2>
      <p
        class="text-muted-foreground mx-auto mb-12 max-w-md font-mono text-sm md:text-base"
      >
        Open for engineering discussions, system design consulting, and
        technical writing opportunities.
      </p>
      <div class="flex justify-center gap-4">
        <Button href={`mailto:${SITE.EMAIL}`} variant="primary"
          >Initialize Handshake</Button
        >
      </div>
    </Container>
  </Section>
</Layout>
