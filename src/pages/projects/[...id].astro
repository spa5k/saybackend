---
import BackToPrevious from "@components/BackToPrevious.astro";
import Container from "@components/Container.astro";
import FormattedDate from "@components/FormattedDate.astro";
import Link from "@components/Link.astro";
import TableOfContents from "@components/TableOfContents.astro";
import Layout from "@layouts/Layout.astro";
import { readingTime } from "@lib/utils";
import { type CollectionEntry, getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const projects = (await getCollection("projects"))
    .filter((post) => !post.data.draft)
    .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
  return projects.map((project) => {
    const cleanId = project.id.replace(/\/index$/, "");
    return {
      params: { id: cleanId },
      props: project,
    };
  });
}
type Props = CollectionEntry<"projects">;

const project = Astro.props;
const { Content, headings } = await render(project);
---

<Layout title={project.data.title} description={project.data.description}>
  <div class="pt-24 pb-24">
    <Container>
      <div class="animate">
        <BackToPrevious href="/projects">Back to projects</BackToPrevious>
      </div>
      <div class="animate my-10 space-y-8">
        <div class="space-y-4">
          <h1
            class="text-4xl leading-[0.85] font-black tracking-tighter text-black uppercase md:text-6xl lg:text-7xl"
          >
            {project.data.title}
          </h1>
        </div>

        <div
          class="flex flex-col gap-4 border-y border-black py-4 md:flex-row md:items-center md:justify-between"
        >
          <div
            class="flex items-center gap-4 font-mono text-xs tracking-wider text-gray-600 uppercase"
          >
            <span>
              <FormattedDate date={project.data.date} />
            </span>
            <span>/</span>
            {
              project.body ? (
                <span>{readingTime(project.body)} READ</span>
              ) : null
            }
          </div>
          {
            (project.data.demoURL || project.data.repoURL) && (
              <nav class="flex items-center gap-4">
                {project.data.demoURL && (
                  <Link href={project.data.demoURL} external underline={false}>
                    demo
                  </Link>
                )}
                {project.data.repoURL && (
                  <Link href={project.data.repoURL} external underline={false}>
                    repo
                  </Link>
                )}
              </nav>
            )
          }
        </div>
      </div>

      <article
        class="animate prose prose-neutral prose-headings:uppercase prose-headings:font-black prose-headings:tracking-tighter prose-a:text-[var(--color-accent)] prose-a:no-underline hover:prose-a:no-underline prose-img:border-structural prose-img:border prose-pre:border-structural prose-pre:border prose-pre:rounded-none w-full max-w-none"
      >
        <Content />
      </article>
    </Container>

    <aside class="fixed top-32 right-8 hidden w-64 2xl:block">
      {headings.length > 0 && <TableOfContents headings={headings} />}
    </aside>
  </div>
</Layout>
