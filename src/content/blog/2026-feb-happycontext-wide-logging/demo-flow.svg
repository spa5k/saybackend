<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="520" fill="none" aria-labelledby="title desc" role="img" viewBox="0 0 1200 520"><title id="title">happycontext request flow</title><desc id="desc">Request lifecycle: start, enrich, finalize, write.</desc><defs><linearGradient id="frameStroke" x1="0" x2="1200" y1="0" y2="520" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#F60" stop-opacity=".42"/><stop offset=".5" stop-color="#F60" stop-opacity=".2"/><stop offset="1" stop-color="#F60" stop-opacity=".4"/></linearGradient><linearGradient id="lineMain" x1="260" x2="900" y1="286" y2="286" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#F60" stop-opacity=".9"/><stop offset="1" stop-color="#F60" stop-opacity=".62"/></linearGradient><filter id="lineGlow" width="140%" height="140%" x="-20%" y="-20%"><feGaussianBlur result="blur" stdDeviation="2.5"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter><radialGradient id="vignette" cx="0" cy="0" r="1" gradientTransform="translate(600 260) rotate(90) scale(340 680)" gradientUnits="userSpaceOnUse"><stop offset=".72" stop-color="#F2F2F0" stop-opacity="0"/><stop offset="1" stop-color="#F60" stop-opacity=".18"/></radialGradient></defs><rect width="1200" height="520" fill="#F2F2F0"/><rect width="1184" height="504" x="8" y="8" fill="none" stroke="url(#frameStroke)" stroke-width="1.5"/><text x="60" y="76" fill="#F60" font-family="Inter, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-size="42" font-weight="700">Request Lifecycle</text><text x="60" y="104" fill="#F60" fill-opacity=".82" font-family="Inter, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-size="17">A single request moves through one event context.</text><path stroke="url(#lineMain)" stroke-linecap="round" stroke-linejoin="round" stroke-width="3.2" d="M260 288C360 258 440 314 540 288C640 262 720 314 820 288C856 284 878 288 900 288" filter="url(#lineGlow)"/><g transform="translate(60 142)"><rect width="200" height="300" fill="#F2F2F0" stroke="#F60" stroke-opacity=".58" stroke-width="1.6" rx="12"/><rect width="200" height="38" fill="#F60" fill-opacity=".1" rx="12"/><text x="16" y="25" fill="#F60" font-family="Inter, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-size="15" font-weight="700">01 START</text><g fill="#F60" font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, monospace" font-size="13"><text x="16" y="78">ctx, ev := hc.New()</text><text x="16" y="108">hc.Add(&quot;method&quot;, ...)</text><text x="16" y="138">hc.Add(&quot;route&quot;, ...)</text><text x="16" y="168">hc.Add(&quot;req_id&quot;, ...)</text></g></g><g transform="translate(340 142)"><rect width="200" height="300" fill="#F2F2F0" stroke="#F60" stroke-opacity=".58" stroke-width="1.6" rx="12"/><rect width="200" height="38" fill="#F60" fill-opacity=".1" rx="12"/><text x="16" y="25" fill="#F60" font-family="Inter, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-size="15" font-weight="700">02 ENRICH</text><g fill="#F60" font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, monospace" font-size="13"><text x="16" y="78">hc.Add(&quot;user_id&quot;, ...)</text><text x="16" y="108">hc.Add(ctx, ...)</text><text x="16" y="138">hc.Error(err)</text><text x="16" y="168">hc.Warn(warn)</text></g></g><g transform="translate(620 142)"><rect width="200" height="300" fill="#F2F2F0" stroke="#F60" stroke-opacity=".58" stroke-width="1.6" rx="12"/><rect width="200" height="38" fill="#F60" fill-opacity=".1" rx="12"/><text x="16" y="25" fill="#F60" font-family="Inter, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-size="15" font-weight="700">03 FINALIZE</text><g fill="#F60" font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, monospace" font-size="13"><text x="16" y="78">hc.Add(&quot;status&quot;, ...)</text><text x="16" y="108">hc.Add(&quot;dur_ms&quot;, ...)</text><text x="16" y="138">sampler.Decide(ev)</text><text x="16" y="168">event complete</text></g></g><g transform="translate(900 142)"><rect width="240" height="300" fill="#F60" fill-opacity=".08" stroke="#F60" stroke-opacity=".72" stroke-width="1.8" rx="12"/><rect width="240" height="38" fill="#F60" fill-opacity=".14" rx="12"/><text x="16" y="25" fill="#F60" font-family="Inter, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-size="15" font-weight="700">04 WRITE</text><rect width="208" height="220" x="16" y="58" fill="#F2F2F0" stroke="#F60" stroke-opacity=".3" rx="8"/><g fill="#F60" font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, monospace" font-size="12"><text x="28" y="86">{</text><text x="38" y="106">&quot;msg&quot;: &quot;request_done&quot;,</text><text x="38" y="124">&quot;status&quot;: 200,</text><text x="38" y="142">&quot;duration_ms&quot;: 12,</text><text x="38" y="160">&quot;route&quot;: &quot;/orders/:id&quot;</text><text x="28" y="178">}</text><text x="28" y="210">sink.Write(event)</text></g></g><rect width="1200" height="520" fill="url(#vignette)"/></svg>